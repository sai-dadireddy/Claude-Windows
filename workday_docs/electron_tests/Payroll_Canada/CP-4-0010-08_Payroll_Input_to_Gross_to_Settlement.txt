================================================================================
TEST ID: CP-4-0010-08
FUNCTIONAL AREA: Payroll for Canada
COUNTRY: CA
TEST NAME: Payroll Input to Gross to Settlement
CONFIDENCE: [HIGH] Score: 8.0/10
SOURCE: [KB Article: kb_payroll_canada_settlement.txt]
================================================================================

DESCRIPTION:
Settle the just completed payroll. Make sure to settle all applicable companies (use the Company Hierarchy, if applicable) and use the 'All Available Pay Groups' filter.

WORKDAY ROLE: Payroll Settlement Specialist
EST. DURATION: 5 minutes
COUNTRY SCOPE: CA

PREREQUISITES:
- User logged in with Payroll Settlement Specialist permissions
- Payroll completed and approved
- All pay calculations finished without errors
- Bank accounts assigned to all employees
- Bank routing rules configured
- GL accounts mapped for payroll posting
- Company hierarchy in place (if multi-company)

ELECTRON STEPS:
1. enter search box as "Create Settlement Run"
2. wait for search results
3. click search result containing "Create Settlement Run"
4. wait for page to load
5. select company field as "{company_name}"
6. wait for company data to load
7. verify company hierarchy displayed (if multi-company setup)
8. select all applicable companies using hierarchy (if applicable)
9. check checkbox "All Available Pay Groups"
10. check checkbox "All Available Pay Group Exceptions"
11. verify payment date is displayed
12. verify pay period dates are correct
13. screenshot as "CP-4-0010-08_settlement_config.png"
14. click button "Submit"
15. wait for confirmation message
16. wait for settlement processing to begin
17. verify settlement run ID is generated
18. screenshot as "CP-4-0010-08_settlement_initiated.png"
19. enter search box as "View Settlement Run"
20. wait for search results
21. click search result containing "View Settlement Run"
22. wait for page to load
23. select settlement run as "{settlement_id}"
24. wait for status to load
25. verify status shows "In Progress" or "Complete"
26. wait for settlement to complete
27. verify no errors displayed
28. verify employee count matches expected
29. verify payment file generated
30. verify GL entries created
31. screenshot as "CP-4-0010-08_complete.png"

VERIFICATION:
- [ ] All applicable companies selected (via hierarchy if needed)
- [ ] All Available Pay Groups filter selected
- [ ] All Available Pay Group Exceptions filter selected
- [ ] Settlement run initiated successfully
- [ ] Settlement completed without errors
- [ ] Payment file (EFT) generated
- [ ] GL journal entries created
- [ ] No suspense account postings
- [ ] Employee payment count matches expected
- [ ] No error messages displayed

SETTLEMENT COMPONENTS:
1. Company Hierarchy - Select parent to include all child companies
2. Pay Group Selection - Use "All Available Pay Groups" for complete settlement
3. Payment File Generation - EFT file for Canadian banks
4. GL Posting - Payroll journal entries
5. Payslip Distribution - Employee payslips released

ERROR HANDLING:
- "No complete pay results": Ensure payroll is completed before settlement
- "Missing bank account": Assign bank account to affected employees
- "Bank routing error": Verify bank routing rules configuration
- "GL account not found": Map missing payroll accounts
- "Suspense account posting": Fix accounting configuration before retry

POST-SETTLEMENT TASKS:
- Submit EFT file to bank (within bank deadline)
- Print cheques for non-EFT employees (if applicable)
- Verify GL journal entries posted correctly
- Distribute payslips to employees
- Archive settlement documentation
- Update payroll calendar for next period

RELATED REPORTS:
- Settlement Run Summary
- Payment Register
- EFT File Report
- Payroll GL Report
- Settlement Exceptions Report

API ALTERNATIVE:
- SOAP (Payroll): Get_Payroll_Results - Verify payroll results after settlement
- SOAP (Payroll): Get_Payroll_Payslips - Retrieve payslips for outsourced payment groups
- Note: Settlement initiation is typically UI-driven, not directly API-accessible

================================================================================
